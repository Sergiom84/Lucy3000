# ๐๏ธ Arquitectura de Lucy3000

Documentaciรณn tรฉcnica de la arquitectura del sistema.

## ๐ Diagrama de Arquitectura General

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     LUCY3000 SYSTEM                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ           ELECTRON DESKTOP APP                       โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  โ         REACT FRONTEND (Renderer)             โ  โ   โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ   โ
โ  โ  โ  โ  Components (UI)                        โ  โ  โ   โ
โ  โ  โ  โ  - Layout, Navbar, Sidebar              โ  โ  โ   โ
โ  โ  โ  โ  - Pages (Dashboard, Clients, etc.)     โ  โ  โ   โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ   โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ   โ
โ  โ  โ  โ  State Management (Zustand)             โ  โ  โ   โ
โ  โ  โ  โ  - Auth Store                           โ  โ  โ   โ
โ  โ  โ  โ  - Theme Store                          โ  โ  โ   โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ   โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ   โ
โ  โ  โ  โ  Utils & Helpers                        โ  โ  โ   โ
โ  โ  โ  โ  - API Client (Axios)                   โ  โ  โ   โ
โ  โ  โ  โ  - Formatters                           โ  โ  โ   โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ                         โ                            โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  โ         ELECTRON MAIN PROCESS                 โ  โ   โ
โ  โ  โ  - Window Management                          โ  โ   โ
โ  โ  โ  - IPC Handlers                               โ  โ   โ
โ  โ  โ  - Native APIs                                โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         โ HTTP/REST                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ           NODE.JS BACKEND (Express)                  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  โ  Routes (API Endpoints)                       โ  โ   โ
โ  โ  โ  /auth, /clients, /appointments, etc.         โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ                         โ                            โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  โ  Middleware                                    โ  โ   โ
โ  โ  โ  - Authentication (JWT)                        โ  โ   โ
โ  โ  โ  - Authorization (Roles)                       โ  โ   โ
โ  โ  โ  - Error Handling                              โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ                         โ                            โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  โ  Controllers (Business Logic)                  โ  โ   โ
โ  โ  โ  - Auth, Clients, Sales, etc.                  โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ                         โ                            โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  โ  Prisma ORM                                    โ  โ   โ
โ  โ  โ  - Models & Queries                            โ  โ   โ
โ  โ  โ  - Migrations                                  โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         โ SQL                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ           SUPABASE (PostgreSQL)                      โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  โ  Database Tables                               โ  โ   โ
โ  โ  โ  - users, clients, appointments                โ  โ   โ
โ  โ  โ  - products, sales, cash_registers             โ  โ   โ
โ  โ  โ  - notifications, settings                     โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Flujo de Datos

### 1. Autenticaciรณn
```
User Input (Login Form)
    โ
React Component
    โ
API Client (Axios)
    โ
POST /api/auth/login
    โ
Auth Controller
    โ
Prisma Query (users table)
    โ
Supabase PostgreSQL
    โ
JWT Token Generation
    โ
Response to Frontend
    โ
Store in Zustand (Auth Store)
    โ
Redirect to Dashboard
```

### 2. Operaciรณn CRUD (Ejemplo: Crear Cliente)
```
User Input (Client Form)
    โ
React Component
    โ
Form Validation
    โ
API Client (with JWT token)
    โ
POST /api/clients
    โ
Auth Middleware (verify token)
    โ
Client Controller
    โ
Prisma Create
    โ
Supabase PostgreSQL
    โ
Response to Frontend
    โ
Update UI
    โ
Show Toast Notification
```

## ๐๏ธ Estructura de Carpetas Detallada

```
Lucy3000/
โ
โโโ ๐ prisma/
โ   โโโ schema.prisma          # Definiciรณn de modelos de BD
โ   โโโ migrations/            # Historial de migraciones
โ
โโโ ๐ src/
โ   โ
โ   โโโ ๐ main/               # Electron Main Process
โ   โ   โโโ main.ts            # Ventana principal, IPC handlers
โ   โ
โ   โโโ ๐ preload.ts          # Bridge seguro entre main y renderer
โ   โ
โ   โโโ ๐ backend/            # API Backend
โ   โ   โ
โ   โ   โโโ ๐ controllers/    # Lรณgica de negocio
โ   โ   โ   โโโ auth.controller.ts
โ   โ   โ   โโโ client.controller.ts
โ   โ   โ   โโโ appointment.controller.ts
โ   โ   โ   โโโ service.controller.ts
โ   โ   โ   โโโ product.controller.ts
โ   โ   โ   โโโ sale.controller.ts
โ   โ   โ   โโโ cash.controller.ts
โ   โ   โ   โโโ notification.controller.ts
โ   โ   โ   โโโ report.controller.ts
โ   โ   โ   โโโ dashboard.controller.ts
โ   โ   โ
โ   โ   โโโ ๐ routes/         # Definiciรณn de endpoints
โ   โ   โ   โโโ auth.routes.ts
โ   โ   โ   โโโ client.routes.ts
โ   โ   โ   โโโ appointment.routes.ts
โ   โ   โ   โโโ service.routes.ts
โ   โ   โ   โโโ product.routes.ts
โ   โ   โ   โโโ sale.routes.ts
โ   โ   โ   โโโ cash.routes.ts
โ   โ   โ   โโโ notification.routes.ts
โ   โ   โ   โโโ report.routes.ts
โ   โ   โ   โโโ dashboard.routes.ts
โ   โ   โ
โ   โ   โโโ ๐ middleware/     # Middleware de Express
โ   โ   โ   โโโ auth.middleware.ts
โ   โ   โ
โ   โ   โโโ server.ts          # Configuraciรณn del servidor
โ   โ
โ   โโโ ๐ renderer/           # React Frontend
โ       โ
โ       โโโ ๐ components/     # Componentes reutilizables
โ       โ   โโโ Layout.tsx
โ       โ   โโโ Navbar.tsx
โ       โ   โโโ Sidebar.tsx
โ       โ
โ       โโโ ๐ pages/          # Pรกginas de la aplicaciรณn
โ       โ   โโโ Login.tsx
โ       โ   โโโ Dashboard.tsx
โ       โ   โโโ Clients.tsx
โ       โ   โโโ ClientDetail.tsx
โ       โ   โโโ Appointments.tsx
โ       โ   โโโ Services.tsx
โ       โ   โโโ Products.tsx
โ       โ   โโโ Sales.tsx
โ       โ   โโโ Cash.tsx
โ       โ   โโโ Reports.tsx
โ       โ   โโโ Settings.tsx
โ       โ
โ       โโโ ๐ stores/         # Estado global (Zustand)
โ       โ   โโโ authStore.ts
โ       โ   โโโ themeStore.ts
โ       โ
โ       โโโ ๐ utils/          # Utilidades
โ       โ   โโโ api.ts         # Cliente HTTP
โ       โ   โโโ format.ts      # Formateo de datos
โ       โ   โโโ cn.ts          # Utilidad de clases CSS
โ       โ
โ       โโโ ๐ styles/         # Estilos globales
โ       โ   โโโ index.css
โ       โ
โ       โโโ App.tsx            # Componente raรญz
โ       โโโ main.tsx           # Punto de entrada
โ
โโโ ๐ scripts/                # Scripts de utilidad
โ   โโโ setup.js               # Configuraciรณn inicial
โ   โโโ create-admin.sql       # Crear usuario admin
โ
โโโ ๐ public/                 # Archivos estรกticos
โ   โโโ icons/                 # Iconos de la app
โ
โโโ ๐ package.json            # Dependencias y scripts
โโโ ๐ tsconfig.json           # Configuraciรณn TypeScript
โโโ ๐ vite.config.ts          # Configuraciรณn Vite
โโโ ๐ tailwind.config.js      # Configuraciรณn Tailwind
โโโ ๐ .env.example            # Variables de entorno ejemplo
โโโ ๐ README.md               # Documentaciรณn principal
โโโ ๐ QUICK_START.md          # Guรญa rรกpida
โโโ ๐ DEPLOYMENT.md           # Guรญa de deployment
โโโ ๐ API_EXAMPLES.md         # Ejemplos de API
โโโ ๐ ARCHITECTURE.md         # Este archivo
```

## ๐ Seguridad

### Autenticaciรณn
- **JWT Tokens**: Tokens firmados con secret key
- **Bcrypt**: Hash de contraseรฑas con salt
- **Middleware**: Verificaciรณn en cada request protegido

### Autorizaciรณn
- **Roles**: ADMIN, MANAGER, EMPLOYEE
- **Permisos**: Basados en roles
- **Middleware**: Verificaciรณn de permisos

### Comunicaciรณn
- **HTTPS**: En producciรณn
- **CORS**: Configurado para dominios permitidos
- **Context Isolation**: En Electron

## ๐ฆ Modelos de Datos

### Relaciones Principales

```
User (1) โโโโโโโโโโโโ (N) Appointment
User (1) โโโโโโโโโโโโ (N) Sale
User (1) โโโโโโโโโโโโ (N) CashMovement

Client (1) โโโโโโโโโโโ (N) Appointment
Client (1) โโโโโโโโโโโ (N) Sale
Client (1) โโโโโโโโโโโ (N) ClientHistory

Service (1) โโโโโโโโโโ (N) Appointment
Service (1) โโโโโโโโโโ (N) SaleItem

Product (1) โโโโโโโโโโ (N) StockMovement
Product (1) โโโโโโโโโโ (N) SaleItem

Sale (1) โโโโโโโโโโโโ (N) SaleItem

CashRegister (1) โโโโโ (N) CashMovement
```

## ๐ Tecnologรญas y Librerรญas

### Frontend
- **Electron**: ^28.1.0 - Desktop app framework
- **React**: ^18.2.0 - UI library
- **TypeScript**: ^5.3.3 - Type safety
- **Vite**: ^5.0.10 - Build tool
- **Tailwind CSS**: ^3.4.0 - Styling
- **Zustand**: ^4.4.7 - State management
- **React Router**: ^6.21.1 - Routing
- **Axios**: ^1.6.5 - HTTP client
- **Recharts**: ^2.10.3 - Charts
- **React Hot Toast**: ^2.4.1 - Notifications
- **Lucide React**: ^0.303.0 - Icons

### Backend
- **Node.js**: 18+ - Runtime
- **Express**: ^4.18.2 - Web framework
- **Prisma**: ^5.8.0 - ORM
- **PostgreSQL**: via Supabase - Database
- **JWT**: ^9.0.2 - Authentication
- **Bcrypt**: ^2.4.3 - Password hashing
- **Zod**: ^3.22.4 - Validation

### DevOps
- **Supabase**: Database hosting
- **Render**: Backend hosting
- **GitHub**: Version control

## ๐ Ciclo de Vida de la Aplicaciรณn

### Desarrollo
```
1. npm install          โ Instalar dependencias
2. npm run prisma:generate โ Generar cliente Prisma
3. npm run prisma:migrate  โ Ejecutar migraciones
4. npm run dev          โ Iniciar dev server
   โโ Backend en :3001
   โโ Electron app
```

### Producciรณn
```
1. npm run build        โ Compilar aplicaciรณn
   โโ Backend โ dist/backend/
   โโ Frontend โ dist/renderer/
   โโ Electron โ release/
2. Deploy backend en Render
3. Distribuir instaladores
```

## ๐ Mรฉtricas y Monitoreo

### Backend
- Request logs en consola
- Error tracking
- Performance metrics (Render)

### Frontend
- React DevTools
- Electron DevTools
- Console logs

### Base de Datos
- Supabase Dashboard
- Query performance
- Storage usage

## ๐ฎ Escalabilidad

### Horizontal
- Backend puede escalar con mรบltiples instancias
- Load balancer en Render
- Database connection pooling

### Vertical
- Upgrade de plan en Render
- Upgrade de plan en Supabase
- Optimizaciรณn de queries

### Cachรฉ
- Redis para sesiones (futuro)
- Local storage en frontend
- Query caching en Prisma

## ๐งช Testing (Futuro)

### Unit Tests
- Jest para backend
- React Testing Library para frontend

### Integration Tests
- Supertest para API
- Cypress para E2E

### Performance Tests
- Lighthouse para frontend
- Artillery para backend

---

**Arquitectura diseรฑada para escalar y mantener ๐**

